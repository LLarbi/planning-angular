import { Injectable } from '@angular/core';
import {HttpClient} from "@angular/common/http";
import {filter, map, Observable, of} from "rxjs";
import {Geo} from "./geo";
import {reportUnhandledError} from "rxjs/internal/util/reportUnhandledError";

@Injectable({
  providedIn: 'root'
})
export class GeoService {

  test: boolean = true
  private testJson = {"documentation":"https://opencagedata.com/api","licenses":[{"name":"see attribution guide","url":"https://opencagedata.com/credits"}],"rate":{"limit":2500,"remaining":2499,"reset":1677542400},"results":[{"annotations":{"DMS":{"lat":"50\u00b0 38' 11.63544'' N","lng":"3\u00b0 3' 48.70152'' E"},"MGRS":"31UES0449209412","Maidenhead":"JO10mp72os","Mercator":{"x":341030.399,"y":6524201.049},"NUTS":{"NUTS0":{"code":"FR"},"NUTS1":{"code":"FRE"},"NUTS2":{"code":"FRE1"},"NUTS3":{"code":"FRE11"}},"OSM":{"edit_url":"https://www.openstreetmap.org/edit?relation=58404#map=17/50.63657/3.06353","note_url":"https://www.openstreetmap.org/note/new#map=17/50.63657/3.06353&layers=N","url":"https://www.openstreetmap.org/?mlat=50.63657&mlon=3.06353#map=17/50.63657/3.06353"},"UN_M49":{"regions":{"EUROPE":"150","FR":"250","WESTERN_EUROPE":"155","WORLD":"001"},"statistical_groupings":["MEDC"]},"callingcode":33,"currency":{"alternate_symbols":[],"decimal_mark":",","html_entity":"\u20ac","iso_code":"EUR","iso_numeric":"978","name":"Euro","smallest_denomination":1,"subunit":"Cent","subunit_to_unit":100,"symbol":"\u20ac","symbol_first":0,"thousands_separator":"."},"flag":"\ud83c\uddeb\ud83c\uddf7","geohash":"u140jdng37unq1t1rn5q","qibla":121.76,"roadinfo":{"drive_on":"right","speed_in":"km/h"},"sun":{"rise":{"apparent":1677479880,"astronomical":1677473340,"civil":1677477900,"nautical":1677475620},"set":{"apparent":1677518640,"astronomical":1677525180,"civil":1677520620,"nautical":1677522900}},"timezone":{"name":"Europe/Paris","now_in_dst":0,"offset_sec":3600,"offset_string":"+0100","short_name":"CET"},"what3words":{"words":"\u00e9purer.nageoire.rimer"},"wikidata":"Q648"},"bounds":{"northeast":{"lat":50.6612596,"lng":3.125725},"southwest":{"lat":50.6008264,"lng":2.9679677}},"components":{"ISO_3166-1_alpha-2":"FR","ISO_3166-1_alpha-3":"FRA","ISO_3166-2":["FR-HDF","FR-59"],"_category":"place","_type":"city","city":"Lille","continent":"Europe","country":"France","country_code":"fr","county":"Nord","municipality":"Lille","political_union":"European Union","region":"France m\u00e9tropolitaine","state":"Hauts-de-France","state_code":"HDF"},"confidence":7,"formatted":"Lille, Nord, France","geometry":{"lat":50.6365654,"lng":3.0635282}},{"annotations":{"DMS":{"lat":"51\u00b0 14' 17.58480'' N","lng":"4\u00b0 49' 27.26544'' E"},"MGRS":"31UFS2734477897","Maidenhead":"JO21jf87ve","Mercator":{"x":537031.985,"y":6630201.359},"NUTS":{"NUTS0":{"code":"BE"},"NUTS1":{"code":"BE2"},"NUTS2":{"code":"BE21"},"NUTS3":{"code":"BE213"}},"OSM":{"edit_url":"https://www.openstreetmap.org/edit?relation=1282972#map=17/51.23822/4.82424","note_url":"https://www.openstreetmap.org/note/new#map=17/51.23822/4.82424&layers=N","url":"https://www.openstreetmap.org/?mlat=51.23822&mlon=4.82424#map=17/51.23822/4.82424"},"UN_M49":{"regions":{"BE":"056","EUROPE":"150","WESTERN_EUROPE":"155","WORLD":"001"},"statistical_groupings":["MEDC"]},"callingcode":32,"currency":{"alternate_symbols":[],"decimal_mark":",","html_entity":"\u20ac","iso_code":"EUR","iso_numeric":"978","name":"Euro","smallest_denomination":1,"subunit":"Cent","subunit_to_unit":100,"symbol":"\u20ac","symbol_first":0,"thousands_separator":"."},"flag":"\ud83c\udde7\ud83c\uddea","geohash":"u157mz8ukbn7geq7j5c4","qibla":124.42,"roadinfo":{"drive_on":"right","speed_in":"km/h"},"sun":{"rise":{"apparent":1677479460,"astronomical":1677472860,"civil":1677477480,"nautical":1677475200},"set":{"apparent":1677518160,"astronomical":1677524820,"civil":1677520200,"nautical":1677522480}},"timezone":{"name":"Europe/Brussels","now_in_dst":0,"offset_sec":3600,"offset_string":"+0100","short_name":"CET"},"what3words":{"words":"accorder.logeur.co\u00fbtante"},"wikidata":"Q725235"},"bounds":{"northeast":{"lat":51.2989944,"lng":4.9072917},"southwest":{"lat":51.2069507,"lng":4.7613106}},"components":{"ISO_3166-1_alpha-2":"BE","ISO_3166-1_alpha-3":"BEL","ISO_3166-2":["BE-VLG","BE-VAN"],"_category":"place","_type":"city","continent":"Europe","country":"Belgique","country_code":"be","county":"Turnhout","political_union":"European Union","postcode":"2275","region":"Flandre","state":"Anvers","state_code":"VAN","town":"Lille"},"confidence":6,"formatted":"2275 Lille, Belgique","geometry":{"lat":51.238218,"lng":4.8242404}},{"annotations":{"DMS":{"lat":"50\u00b0 37' 5.03004'' N","lng":"3\u00b0 2' 43.09332'' E"},"MGRS":"31UES0320407354","Maidenhead":"JO10mo58ki","Mercator":{"x":339001.656,"y":6520963.148},"NUTS":{"NUTS0":{"code":"FR"},"NUTS1":{"code":"FRE"},"NUTS2":{"code":"FRE1"},"NUTS3":{"code":"FRE11"}},"OSM":{"edit_url":"https://www.openstreetmap.org/edit?relation=1643919#map=17/50.61806/3.04530","note_url":"https://www.openstreetmap.org/note/new#map=17/50.61806/3.04530&layers=N","url":"https://www.openstreetmap.org/?mlat=50.61806&mlon=3.04530#map=17/50.61806/3.04530"},"UN_M49":{"regions":{"EUROPE":"150","FR":"250","WESTERN_EUROPE":"155","WORLD":"001"},"statistical_groupings":["MEDC"]},"callingcode":33,"currency":{"alternate_symbols":[],"decimal_mark":",","html_entity":"\u20ac","iso_code":"EUR","iso_numeric":"978","name":"Euro","smallest_denomination":1,"subunit":"Cent","subunit_to_unit":100,"symbol":"\u20ac","symbol_first":0,"thousands_separator":"."},"flag":"\ud83c\uddeb\ud83c\uddf7","geohash":"u0fpvq9x8ep0b7nntbep","qibla":121.72,"roadinfo":{"drive_on":"right","speed_in":"km/h"},"sun":{"rise":{"apparent":1677479880,"astronomical":1677473340,"civil":1677477900,"nautical":1677475620},"set":{"apparent":1677518640,"astronomical":1677525180,"civil":1677520620,"nautical":1677522900}},"timezone":{"name":"Europe/Paris","now_in_dst":0,"offset_sec":3600,"offset_string":"+0100","short_name":"CET"},"what3words":{"words":"copiage.dommage.rebord"},"wikidata":"Q701510"},"bounds":{"northeast":{"lat":50.7946088,"lng":3.3291133},"southwest":{"lat":50.4416259,"lng":2.789132}},"components":{"ISO_3166-1_alpha-2":"FR","ISO_3166-1_alpha-3":"FRA","ISO_3166-2":["FR-HDF","FR-59"],"_category":"place","_type":"municipality","continent":"Europe","country":"France","country_code":"fr","county":"Nord","municipality":"Lille","political_union":"European Union","region":"France m\u00e9tropolitaine","state":"Hauts-de-France","state_code":"HDF"},"confidence":3,"formatted":"Lille, Nord, France","geometry":{"lat":50.6180639,"lng":3.0453037}},{"annotations":{"DMS":{"lat":"51\u00b0 15' 20.27124'' N","lng":"4\u00b0 49' 39.26748'' E"},"MGRS":"31UFS2752979839","Maidenhead":"JO21jg91hi","Mercator":{"x":537403.118,"y":6633289.852},"NUTS":{"NUTS0":{"code":"BE"},"NUTS1":{"code":"BE2"},"NUTS2":{"code":"BE21"},"NUTS3":{"code":"BE213"}},"OSM":{"edit_url":"https://www.openstreetmap.org/edit?relation=3875454#map=17/51.25563/4.82757","note_url":"https://www.openstreetmap.org/note/new#map=17/51.25563/4.82757&layers=N","url":"https://www.openstreetmap.org/?mlat=51.25563&mlon=4.82757#map=17/51.25563/4.82757"},"UN_M49":{"regions":{"BE":"056","EUROPE":"150","WESTERN_EUROPE":"155","WORLD":"001"},"statistical_groupings":["MEDC"]},"callingcode":32,"currency":{"alternate_symbols":[],"decimal_mark":",","html_entity":"\u20ac","iso_code":"EUR","iso_numeric":"978","name":"Euro","smallest_denomination":1,"subunit":"Cent","subunit_to_unit":100,"symbol":"\u20ac","symbol_first":0,"thousands_separator":"."},"flag":"\ud83c\udde7\ud83c\uddea","geohash":"u157tfg3dwh7fg4m6r06","qibla":124.44,"roadinfo":{"drive_on":"right","speed_in":"km/h"},"sun":{"rise":{"apparent":1677479460,"astronomical":1677472860,"civil":1677477480,"nautical":1677475200},"set":{"apparent":1677518160,"astronomical":1677524820,"civil":1677520200,"nautical":1677522480}},"timezone":{"name":"Europe/Brussels","now_in_dst":0,"offset_sec":3600,"offset_string":"+0100","short_name":"CET"},"what3words":{"words":"patriote.cr\u00e9mer.surv\u00eatement"}},"bounds":{"northeast":{"lat":51.28671,"lng":4.8602225},"southwest":{"lat":51.2244414,"lng":4.778956}},"components":{"ISO_3166-1_alpha-2":"BE","ISO_3166-1_alpha-3":"BEL","ISO_3166-2":["BE-VLG","BE-VAN"],"_category":"place","_type":"neighbourhood","city_district":"Lille","continent":"Europe","country":"Belgique","country_code":"be","county":"Turnhout","political_union":"European Union","postcode":"2275","region":"Flandre","state":"Anvers","state_code":"VAN","town":"Lille"},"confidence":7,"formatted":"2275 Lille, Belgique","geometry":{"lat":51.2556309,"lng":4.8275743}},{"annotations":{"DMS":{"lat":"50\u00b0 37' 44.75892'' N","lng":"3\u00b0 3' 34.94628'' E"},"MGRS":"31UES0422208582","Maidenhead":"JO10mp70dx","Mercator":{"x":340605.055,"y":6522894.338},"NUTS":{"NUTS0":{"code":"FR"},"NUTS1":{"code":"FRE"},"NUTS2":{"code":"FRE1"},"NUTS3":{"code":"FRE11"}},"OSM":{"edit_url":"https://www.openstreetmap.org/edit?relation=9402509#map=17/50.62910/3.05971","note_url":"https://www.openstreetmap.org/note/new#map=17/50.62910/3.05971&layers=N","url":"https://www.openstreetmap.org/?mlat=50.62910&mlon=3.05971#map=17/50.62910/3.05971"},"UN_M49":{"regions":{"EUROPE":"150","FR":"250","WESTERN_EUROPE":"155","WORLD":"001"},"statistical_groupings":["MEDC"]},"callingcode":33,"currency":{"alternate_symbols":[],"decimal_mark":",","html_entity":"\u20ac","iso_code":"EUR","iso_numeric":"978","name":"Euro","smallest_denomination":1,"subunit":"Cent","subunit_to_unit":100,"symbol":"\u20ac","symbol_first":0,"thousands_separator":"."},"flag":"\ud83c\uddeb\ud83c\uddf7","geohash":"u140j8spbk5pejjx18j6","qibla":121.75,"roadinfo":{"drive_on":"right","speed_in":"km/h"},"sun":{"rise":{"apparent":1677479880,"astronomical":1677473340,"civil":1677477900,"nautical":1677475620},"set":{"apparent":1677518640,"astronomical":1677525180,"civil":1677520620,"nautical":1677522900}},"timezone":{"name":"Europe/Paris","now_in_dst":0,"offset_sec":3600,"offset_string":"+0100","short_name":"CET"},"what3words":{"words":"effacer.toiler.doux"}},"bounds":{"northeast":{"lat":50.6571564,"lng":3.1040272},"southwest":{"lat":50.6008264,"lng":3.0168437}},"components":{"ISO_3166-1_alpha-2":"FR","ISO_3166-1_alpha-3":"FRA","ISO_3166-2":["FR-HDF","FR-59"],"_category":"place","_type":"neighbourhood","city":"Lille","city_district":"Lille","continent":"Europe","country":"France","country_code":"fr","county":"Nord","municipality":"Lille","political_union":"European Union","region":"France m\u00e9tropolitaine","state":"Hauts-de-France","state_code":"HDF"},"confidence":7,"formatted":"Lille, Nord, France","geometry":{"lat":50.6290997,"lng":3.0597073}},{"annotations":{"DMS":{"lat":"59\u00b0 25' 50.87568'' N","lng":"24\u00b0 43' 0.85116'' E"},"MGRS":"35VLF7048990245","Maidenhead":"KO29ik63aj","Mercator":{"x":2751473.062,"y":8237263.055},"NUTS":{"NUTS0":{"code":"EE"},"NUTS1":{"code":"EE0"},"NUTS2":{"code":"EE00"},"NUTS3":{"code":"EE001"}},"OSM":{"edit_url":"https://www.openstreetmap.org/edit?way=1120767462#map=17/59.43080/24.71690","note_url":"https://www.openstreetmap.org/note/new#map=17/59.43080/24.71690&layers=N","url":"https://www.openstreetmap.org/?mlat=59.43080&mlon=24.71690#map=17/59.43080/24.71690"},"UN_M49":{"regions":{"EE":"233","EUROPE":"150","NORTHERN_EUROPE":"154","WORLD":"001"},"statistical_groupings":["MEDC"]},"callingcode":372,"currency":{"alternate_symbols":[],"decimal_mark":",","html_entity":"\u20ac","iso_code":"EUR","iso_numeric":"978","name":"Euro","smallest_denomination":1,"subunit":"Cent","subunit_to_unit":100,"symbol":"\u20ac","symbol_first":0,"thousands_separator":"."},"flag":"\ud83c\uddea\ud83c\uddea","geohash":"ud9d47n33xfezjru23bw","qibla":157.58,"roadinfo":{"drive_on":"right","speed_in":"km/h"},"sun":{"rise":{"apparent":1677475560,"astronomical":1677467400,"civil":1677473100,"nautical":1677470280},"set":{"apparent":1677512580,"astronomical":1677520740,"civil":1677515040,"nautical":1677517860}},"timezone":{"name":"Europe/Tallinn","now_in_dst":0,"offset_sec":7200,"offset_string":"+0200","short_name":"EET"},"what3words":{"words":"nacrons.soupirail.logistique"},"wikidata":"Q20530102"},"bounds":{"northeast":{"lat":59.4339997,"lng":24.7246601},"southwest":{"lat":59.4276523,"lng":24.7058289}},"components":{"ISO_3166-1_alpha-2":"EE","ISO_3166-1_alpha-3":"EST","ISO_3166-2":["EE-37"],"_category":"place","_type":"neighbourhood","city":"Tallinn","continent":"Europe","country":"Estonie","country_code":"ee","county":"Harju maakond","municipality":"Tallinn","neighbourhood":"Lille","political_union":"European Union","suburb":"Kristiine linnaosa"},"confidence":9,"formatted":"Kristiine linnaosa, Tallinn, Harju maakond, Estonie","geometry":{"lat":59.4307988,"lng":24.7169031}},{"annotations":{"DMS":{"lat":"47\u00b0 16' 48.14832'' N","lng":"68\u00b0 6' 35.11908'' W"},"FIPS":{"county":"23003","state":"23"},"MGRS":"19TEN6732636669","Maidenhead":"FN57wg67tf","Mercator":{"x":-7581943.278,"y":5956497.4},"OSM":{"edit_url":"https://www.openstreetmap.org/edit?node=158809287#map=17/47.28004/-68.10976","note_url":"https://www.openstreetmap.org/note/new#map=17/47.28004/-68.10976&layers=N","url":"https://www.openstreetmap.org/?mlat=47.28004&mlon=-68.10976#map=17/47.28004/-68.10976"},"UN_M49":{"regions":{"AMERICAS":"019","NORTHERN_AMERICA":"021","US":"840","WORLD":"001"},"statistical_groupings":["MEDC"]},"callingcode":1,"currency":{"alternate_symbols":["US$"],"decimal_mark":".","disambiguate_symbol":"US$","html_entity":"$","iso_code":"USD","iso_numeric":"840","name":"United States Dollar","smallest_denomination":1,"subunit":"Cent","subunit_to_unit":100,"symbol":"$","symbol_first":1,"thousands_separator":","},"flag":"\ud83c\uddfa\ud83c\uddf8","geohash":"f2rsfp5fpwmrxc4r1t51","qibla":62.64,"roadinfo":{"drive_on":"right","speed_in":"mph"},"sun":{"rise":{"apparent":1677496620,"astronomical":1677490560,"civil":1677494820,"nautical":1677492660},"set":{"apparent":1677536040,"astronomical":1677542100,"civil":1677537840,"nautical":1677540000}},"timezone":{"name":"America/New_York","now_in_dst":0,"offset_sec":-18000,"offset_string":"-0500","short_name":"EST"},"what3words":{"words":"f\u00e9culerie.fleuriste.p\u00e9pite"}},"bounds":{"northeast":{"lat":47.2900412,"lng":-68.0997553},"southwest":{"lat":47.2700412,"lng":-68.1197553}},"components":{"ISO_3166-1_alpha-2":"US","ISO_3166-1_alpha-3":"USA","ISO_3166-2":["US-ME"],"_category":"place","_type":"neighbourhood","continent":"North America","country":"\u00c9tats-Unis d'Am\u00e9rique","country_code":"us","county":"Aroostook County","neighbourhood":"Lille","postcode":"04749","state":"Maine","state_code":"ME","town":"Grand Isle"},"confidence":8,"formatted":"Grand Isle, ME 04749, \u00c9tats-Unis d'Am\u00e9rique","geometry":{"lat":47.2800412,"lng":-68.1097553}},{"annotations":{"DMS":{"lat":"46\u00b0 44' 30.60492'' N","lng":"0\u00b0 18' 19.82268'' E"},"MGRS":"31TBM9416980001","Maidenhead":"JN06dr68pa","Mercator":{"x":34008.806,"y":5868903.806},"NUTS":{"NUTS0":{"code":"FR"},"NUTS1":{"code":"FRI"},"NUTS2":{"code":"FRI3"},"NUTS3":{"code":"FRI34"}},"OSM":{"edit_url":"https://www.openstreetmap.org/edit?node=7006486544#map=17/46.74183/0.30551","note_url":"https://www.openstreetmap.org/note/new#map=17/46.74183/0.30551&layers=N","url":"https://www.openstreetmap.org/?mlat=46.74183&mlon=0.30551#map=17/46.74183/0.30551"},"UN_M49":{"regions":{"EUROPE":"150","FR":"250","WESTERN_EUROPE":"155","WORLD":"001"},"statistical_groupings":["MEDC"]},"callingcode":33,"currency":{"alternate_symbols":[],"decimal_mark":",","html_entity":"\u20ac","iso_code":"EUR","iso_numeric":"978","name":"Euro","smallest_denomination":1,"subunit":"Cent","subunit_to_unit":100,"symbol":"\u20ac","symbol_first":0,"thousands_separator":"."},"flag":"\ud83c\uddeb\ud83c\uddf7","geohash":"u021yvn6yvd08q8rs8sm","qibla":114.72,"roadinfo":{"drive_on":"right","speed_in":"km/h"},"sun":{"rise":{"apparent":1677480240,"astronomical":1677474180,"civil":1677478380,"nautical":1677476280},"set":{"apparent":1677519600,"astronomical":1677525660,"civil":1677521460,"nautical":1677523560}},"timezone":{"name":"Europe/Paris","now_in_dst":0,"offset_sec":3600,"offset_string":"+0100","short_name":"CET"},"what3words":{"words":"soigneux.horaire.semons"}},"bounds":{"northeast":{"lat":46.7618347,"lng":0.3255063},"southwest":{"lat":46.7218347,"lng":0.2855063}},"components":{"ISO_3166-1_alpha-2":"FR","ISO_3166-1_alpha-3":"FRA","ISO_3166-2":["FR-NAQ","FR-86"],"_category":"place","_type":"hamlet","city":"Saint-Martin-la-Pallu","city_district":"Vendeuvre-du-Poitou","continent":"Europe","country":"France","country_code":"fr","county":"Vienne","hamlet":"Lille","municipality":"Poitiers","political_union":"European Union","postcode":"86380","region":"France m\u00e9tropolitaine","state":"Nouvelle-Aquitaine","state_code":"NAQ"},"confidence":7,"formatted":"86380 Lille, France","geometry":{"lat":46.7418347,"lng":0.3055063}},{"annotations":{"DMS":{"lat":"44\u00b0 10' 1.81092'' N","lng":"2\u00b0 1' 48.80640'' E"},"MGRS":"31TDJ2246790897","Maidenhead":"JN14ae30pc","Mercator":{"x":226003.502,"y":5461566.556},"NUTS":{"NUTS0":{"code":"FR"},"NUTS1":{"code":"FRJ"},"NUTS2":{"code":"FRJ2"},"NUTS3":{"code":"FRJ27"}},"OSM":{"edit_url":"https://www.openstreetmap.org/edit?node=3282379739#map=17/44.16717/2.03022","note_url":"https://www.openstreetmap.org/note/new#map=17/44.16717/2.03022&layers=N","url":"https://www.openstreetmap.org/?mlat=44.16717&mlon=2.03022#map=17/44.16717/2.03022"},"UN_M49":{"regions":{"EUROPE":"150","FR":"250","WESTERN_EUROPE":"155","WORLD":"001"},"statistical_groupings":["MEDC"]},"callingcode":33,"currency":{"alternate_symbols":[],"decimal_mark":",","html_entity":"\u20ac","iso_code":"EUR","iso_numeric":"978","name":"Euro","smallest_denomination":1,"subunit":"Cent","subunit_to_unit":100,"symbol":"\u20ac","symbol_first":0,"thousands_separator":"."},"flag":"\ud83c\uddeb\ud83c\uddf7","geohash":"spc7q0qk7thtxxfmtn77","qibla":113.71,"roadinfo":{"drive_on":"right","speed_in":"km/h"},"sun":{"rise":{"apparent":1677479640,"astronomical":1677473880,"civil":1677477900,"nautical":1677475860},"set":{"apparent":1677519360,"astronomical":1677525120,"civil":1677521100,"nautical":1677523140}},"timezone":{"name":"Europe/Paris","now_in_dst":0,"offset_sec":3600,"offset_string":"+0100","short_name":"CET"},"what3words":{"words":"\u00e2nier.osant.favorite"}},"bounds":{"northeast":{"lat":44.1871697,"lng":2.050224},"southwest":{"lat":44.1471697,"lng":2.010224}},"components":{"ISO_3166-1_alpha-2":"FR","ISO_3166-1_alpha-3":"FRA","ISO_3166-2":["FR-OCC","FR-81"],"_category":"place","_type":"hamlet","continent":"Europe","country":"France","country_code":"fr","county":"Tarn","hamlet":"Lille","municipality":"Albi","political_union":"European Union","postcode":"81190","region":"France m\u00e9tropolitaine","state":"Occitanie","state_code":"OCC","village":"Saint-Christophe"},"confidence":7,"formatted":"81190 Saint-Christophe, France","geometry":{"lat":44.1671697,"lng":2.030224}},{"annotations":{"DMS":{"lat":"58\u00b0 5' 29.36256'' N","lng":"8\u00b0 1' 4.33812'' E"},"MGRS":"32VMK4209639317","Maidenhead":"JO48ac21dw","Mercator":{"x":892545.394,"y":7950257.043},"OSM":{"edit_url":"https://www.openstreetmap.org/edit?way=157523471#map=17/58.09149/8.01787","note_url":"https://www.openstreetmap.org/note/new#map=17/58.09149/8.01787&layers=N","url":"https://www.openstreetmap.org/?mlat=58.09149&mlon=8.01787#map=17/58.09149/8.01787"},"UN_M49":{"regions":{"EUROPE":"150","NO":"578","NORTHERN_EUROPE":"154","WORLD":"001"},"statistical_groupings":["MEDC"]},"callingcode":47,"currency":{"alternate_symbols":[",-"],"decimal_mark":",","disambiguate_symbol":"NOK","format":"%n %u","html_entity":"kr","iso_code":"NOK","iso_numeric":"578","name":"Norwegian Krone","smallest_denomination":100,"subunit":"\u00d8re","subunit_to_unit":100,"symbol":"kr","symbol_first":0,"thousands_separator":"."},"flag":"\ud83c\uddf3\ud83c\uddf4","geohash":"u4mdqrnrmyw3wkx4j2xx","qibla":134.28,"roadinfo":{"drive_on":"right","speed_in":"km/h"},"sun":{"rise":{"apparent":1677479400,"astronomical":1677471540,"civil":1677477000,"nautical":1677474300},"set":{"apparent":1677516720,"astronomical":1677524580,"civil":1677519120,"nautical":1677521820}},"timezone":{"name":"Europe/Berlin","now_in_dst":0,"offset_sec":3600,"offset_string":"+0100","short_name":"CET"},"what3words":{"words":"lacuneuse.tol\u00e9rer.meuler"}},"bounds":{"northeast":{"lat":58.0925102,"lng":8.0206247},"southwest":{"lat":58.0904949,"lng":8.0163086}},"components":{"ISO_3166-1_alpha-2":"NO","ISO_3166-1_alpha-3":"NOR","ISO_3166-2":["NO-42"],"_category":"road","_type":"road","city":"Kristiansand","continent":"Europe","country":"Norv\u00e8ge","country_code":"no","county":"Agder","municipality":"Kristiansand","place":"Lille Ris\u00f8ya"},"confidence":9,"formatted":"Lille Ris\u00f8ya, Kristiansand, Norv\u00e8ge","geometry":{"lat":58.0914896,"lng":8.0178717}}],"status":{"code":200,"message":"OK"},"stay_informed":{"blog":"https://blog.opencagedata.com","mastodon":"https://en.osm.town/@opencage","twitter":"https://twitter.com/OpenCage"},"thanks":"For using an OpenCage API","timestamp":{"created_http":"Mon, 27 Feb 2023 06:45:25 GMT","created_unix":1677480325},"total_results":10}
  private observableTest= of(this.testJson);

  private url: string ="https://api.opencagedata.com/geocode/v1/json?key=efc6b1cc34cf45dab548d011243ec262&no_dedupe=1"


  constructor(
    private http: HttpClient
  ) { }

  getGeoLoc(city: string): Observable<Geo[]> {

    if (this.test) {
      return this.observableTest.pipe(
        filter(data => data.results && Array.isArray(data.results)),
        map(data => data.results.filter((result:any) => result.components._type === 'city' || result.components._type === 'village')),
        map(filteredResults => filteredResults.map((result:any) => ( new Geo(
            result.geometry.lat,
            result.geometry.lng,
            result.formatted,
            result.annotations.flag)
        ))))
    } else {
    return this.http.get<any>(this.url+"&q="+city).pipe(
      filter(data => data.results && Array.isArray(data.results)),
      map(data => data.results.filter((result:any) => result.components._type === 'city' || result.components._type === 'village')),
      map(filteredResults => filteredResults.map((result:any) => ( new Geo(
        result.geometry.lat,
        result.geometry.lng,
        result.formatted,
        result.annotations.flag)
        ))))
    }
  }
}
